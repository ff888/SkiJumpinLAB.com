{% extends 'ski/base.html' %}
{% block content %}

<div class="container my-4">
    <form method="GET" action="{% url 'statistics' %}">
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="season_filter">FILTER BY SEASON</label>
                    <select class="form-control" id="season_filter" name="season_filter">
                        <option value="">ALL</option>
                        {% for season in categories.season_filter %}
                        <option value="{{ season }}">{{ season }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="city_filter">FILTER BY CITY</label>
                    <select class="form-control" id="city_filter" name="city_filter">
                        <option value="">ALL</option>
                        {% for city in categories.city_filter %}
                        <option value="{{ city }}">{{ city }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="tournament_filter">FILTER BY TOURNAMENT TYPE</label>
                    <select class="form-control" id="tournament_filter" name="tournament_filter">
                        <option value="">ALL</option>
                        {% for tour in categories.tournament_filter %}
                        <option value="{{ tour }}">{{ tour }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="hill_filter">FILTER BY HILL SIZE</label>
                    <select class="form-control" id="hill_filter" name="hill_filter">
                        <option value="">ALL</option>
                        <option value="SF">Flying Hill - (Mahmut)</option>
                        <option value="LH">Large Hill</option>
                        <option value="NH">Normal Hill</option>
                        <option value="SH">Small Hill</option>
                        <option value="{{ hill }}">{{ hill }}</option>
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="gender_filter">FILTER BY GENDER</label>
                    <select class="form-control" id="gender_filter" name="gender_filter">
                        <option value="">ALL</option>
                        <option value="M">Man</option>
                        <option value="W">Woman</option>
                        <option value="{{ gender }}">{{ gender }}</option>

                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="team_filter">FILTER BY COMPETITION TYPE</label>
                    <select class="form-control" id="team_filter" name="team_filter">
                        <option value="">ALL</option>
                        {% for team in categories.team_filter %}
                        <option value="{{ team }}">{{ team }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center mt-3">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </form>
</div>

{% if rows %}
<!-- Tables Tabs -->
<ul class="nav nav-tabs">
    <li class="nav-item">
        <a class="nav-link active" href="?sort_by=ranking_table#ranking_table" name="ranking_table" data-bs-toggle="tab">Sort by Ranking</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="?sort_by=speed_table#speed_table" name="speed_table" data-bs-toggle="tab">Sort by Speed</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="?sort_by=style_table#style_table" name="style_table" data-bs-toggle="tab">Sort by Style</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="?sort_by=luck_table#luck_table" name="luck_table" data-bs-toggle="tab">Sort by Luck</a>
    </li>
</ul>

<!-- Ranking Table -->
<div class="tab-content">
    <div id="ranking_table" class="tab-pane active">
        <div class="table-responsive custom-table">
            <table class="table table-striped table-bordered mb-4">
                <thead>
                    <tr>
                        <th colspan="8" class="text-center">
                            <h4>{{ table_title }}</h4>
                        </th>
                    </tr>
                    <tr>
                        <th>RANKING</th>
                        <th>NAME</th>
                        <th>NATIONALITY</th>
                        <th>DISTANCE JUMP 1</th>
                        <th>TOTAL POINTS JUMP 1</th>
                        <th>DISTANCE JUMP 2</th>
                        <th>TOTAL POINTS JUMP 2</th>
                        <th>TOTAL RANKING</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row.RANKING }}</td>
                        <td>{{ row.NAME }}</td>
                        <td>{{ row.NATIONALITY }}</td>
                        <td>{{ row.DISTANCE_JUMP_1 }}</td>
                        <td>{{ row.TOTAL_POINTS_JUMP_1 }}</td>
                        <td>{{ row.DISTANCE_JUMP_2 }}</td>
                        <td>{{ row.TOTAL_POINTS_JUMP_2 }}</td>
                        <td>{{ row.TOTAL_POINTS }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Speed Table -->
<div class="tab-content">
    <div id="speed_table" class="tab-pane">
        <div class="table-responsive custom-table">
            <table class="table table-striped table-bordered mb-4">
                <thead>
                    <tr>
                        <th colspan="8" class="text-center">
                            <h4>{{ table_title }}</h4>
                        </th>
                    </tr>
                    <tr>
                        <th>RANKING</th>
                        <th>NAME</th>
                        <th>NATIONALITY</th>
                        <th>SPEED JUMP 1</th>
                        <th>SPEED JUMP 2</th>
                        <th>SPEED JUMPS SUM</th>
                        <th>RANKING BY SPEED</th>
                        <th>TOTAL RANKING</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row.RANKING }}</td>
                        <td>{{ row.NAME }}</td>
                        <td>{{ row.NATIONALITY }}</td>
                        <td>{{ row.SPEED_JUMP_1 }}</td>
                        <td>{{ row.SPEED_JUMP_2 }}</td>
                        <td>{{ row.SPEED_JUMPS_SUM }}</td>
                        <td>{{ row.RANKING_BY_SPEED }}</td>
                        <td>{{ row.TOTAL_POINTS }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Style Table -->
<div class="tab-content">
    <div id="style_table" class="tab-pane">
        <div class="table-responsive custom-table">
            <table class="table table-striped table-bordered mb-4">
                <thead>
                    <tr>
                        <th colspan="8" class="text-center">
                            <h4>{{ table_title }}</h4>
                        </th>
                    </tr>
                    <thead>
                        <tr>
                            <th colspan="1">RANKING</th>
                            <th colspan="1">NAME</th>
                            <th colspan="1">NATIONALITY</th>
                            <th colspan="5">JUDGE MARKS JUMP 1</th>
                            <th colspan="1">JUDGE TOTAL POINTS JUMP 1</th>
                            <th colspan="5">JUDGE MARKS JUMP 2</th>
                            <th colspan="1">JUDGE TOTAL POINTS JUMP 2</th>
                            <th colspan="1">STYLE TOTAL POINTS</th>
                            <th colspan="1">STYLE RANKING</th>
                        </tr>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>A</th>
                          <th>B</th>
                          <th>C</th>
                          <th>D</th>
                          <th>E</th>
                          <th></th>
                          <th>A</th>
                          <th>B</th>
                          <th>C</th>
                          <th>D</th>
                          <th>E</th>
                          <th></th>
                          <th></th>
                          <th></th>
                        </tr>
                      </thead>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row.RANKING }}</td>
                        <td>{{ row.NAME }}</td>
                        <td>{{ row.NATIONALITY }}</td>
                        <td>{{ row.JUDGE_MARKS_A_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_MARKS_B_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_MARKS_C_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_MARKS_D_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_MARKS_E_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_TOTAL_POINTS_JUMP_1 }}</td>
                        <td>{{ row.JUDGE_MARKS_A_JUMP_2 }}</td>
                        <td>{{ row.JUDGE_MARKS_B_JUMP_2 }}</td>
                        <td>{{ row.JUDGE_MARKS_C_JUMP_2 }}</td>
                        <td>{{ row.JUDGE_MARKS_D_JUMP_2 }}</td>
                        <td>{{ row.JUDGE_MARKS_E_JUMP_2 }}</td>
                        <td>{{ row.JUDGE_TOTAL_POINTS_JUMP_2 }}</td>
                        <td>{{ row.STYLE_TOTAL_POINTS }}</td>
                        <td>{{ row.STYLE_RANKING }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Luck Table -->
<div class="tab-content">
    <div id="luck_table" class="tab-pane">
        <div class="table-responsive custom-table">
            <table class="table table-striped table-bordered mb-4">
                <thead>
                    <tr>
                        <th colspan="11" class="text-center">
                            <h4>{{ table_title }}</h4>
                        </th>
                    </tr>
                    <tr>
                        <th>RANKING</th>
                        <th>NAME</th>
                        <th>NATIONALITY</th>
                        <th>GATE COMPENSATION JUMP 1</th>
                        <th>WIND JUMP 1</th>
                        <th>WIND COMPENSATION JUMP 1</th>
                        <th>GATE COMPENSATION JUMP 2</th>
                        <th>WIND JUMP 2</th>
                        <th>WIND COMPENSATION JUMP 2</th>
                        <th>COMPENSATION POINTS</th>
                        <th>LUCK RANKING</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td>{{ row.RANKING }}</td>
                        <td>{{ row.NAME }}</td>
                        <td>{{ row.NATIONALITY }}</td>
                        <td>{{ row.GATE_COMPENSATION_JUMP_1 }}</td>
                        <td>{{ row.WIND_JUMP_1 }}</td>
                        <td>{{ row.WIND_COMPENSATION_JUMP_1 }}</td>
                        <td>{{ row.GATE_COMPENSATION_JUMP_2 }}</td>
                        <td>{{ row.WIND_JUMP_2 }}</td>
                        <td>{{ row.WIND_COMPENSATION_JUMP_2 }}</td>
                        <td>{{ row.COMPENSATION_POINTS }}</td>
                        <td>{{ row.LUCK_RANKING }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endif %}

{% if filtered_csv_files and not rows %}
<div class="list-group">
    <h2 class="text-center my-4">Select Tournament</h2>
    {% for file in filtered_csv_files %}
    <a href="{% url 'statistics' %}?selected_file={{ file }}" class="list-group-item list-group-item-action">
        <span class="link-text">{{ file }}</span>
        <i class="fas fa-external-link-alt ml-2"></i>
    </a>
    {% endfor %}
</div>
{% endif %}

{% endblock content %}